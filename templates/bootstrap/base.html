{# Local override of Flask-Bootstrap's base template.
   Keep block names compatible with existing templates (head/styles/scripts/content). #}
{% set endpoint = request.endpoint or '' %}
{% set is_article_page = endpoint in ['edit', 'view', '_print'] %}
{% set article_short = '' %}
{% set article_numeric_id = '' %}
{% if is_article_page and form is defined %}
  {% set article_short = form.short.data|default('', true) %}
  {% set article_numeric_id = form.id.data|default('', true) %}
{% endif %}
<!doctype html>
<html lang="en">
  <head>
    {% block head %}
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="color-scheme" content="light">
      <title>
        {%- block title -%}
          {%- if is_article_page and (article_short or article_numeric_id) -%}
            {{ (article_short or ('#' ~ article_numeric_id)) }} — XPHITQRI
          {%- elif title -%}
            {{ title }} — XPHITQRI
          {%- else -%}
            XPHITQRI
          {%- endif -%}
        {%- endblock -%}
      </title>
    {% endblock %}

    {% block styles %}
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
      <link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}">
    {% endblock %}
  </head>

  <body
    class="app-body endpoint-{{ (request.endpoint or 'unknown')|replace('.', '-') }}{% if mode %} mode-{{ mode }}{% endif %}"
    {% if is_article_page %}
      data-article-short="{{ article_short }}"
      data-article-id="{{ article_numeric_id }}"
    {% endif %}
  >
    <a class="sr-only sr-only-focusable" href="#main">Skip to content</a>

    <nav class="navbar navbar-default app-navbar" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button
            type="button"
            class="navbar-toggle collapsed"
            data-toggle="collapse"
            data-target="#app-navbar-collapse"
            aria-expanded="false"
          >
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="{{ url_for('index') }}">
            XPHITQRI
            {% if is_article_page and (article_short or article_numeric_id) %}
              <span class="app-navbar-article">{{ article_short or ('#' ~ article_numeric_id) }}</span>
            {% endif %}
          </a>
        </div>

        <div class="collapse navbar-collapse" id="app-navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="{{ 'active' if request.endpoint == 'index' else '' }}">
              <a href="{{ url_for('index') }}">Articles</a>
            </li>
            <li class="{{ 'active' if request.endpoint == 'compare' else '' }}">
              <a href="{{ url_for('compare') }}">Compare</a>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            {% if current_user.is_authenticated %}
              <li class="navbar-text app-navbar-user">{{ current_user.username }}</li>
              <li><a href="{{ url_for('logout') }}">Logout</a></li>
            {% else %}
              <li class="{{ 'active' if request.endpoint == 'login' else '' }}">
                <a href="{{ url_for('login') }}">Sign in</a>
              </li>
              <li class="{{ 'active' if request.endpoint == 'register' else '' }}">
                <a href="{{ url_for('register') }}">Register</a>
              </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <main id="main" class="app-main" role="main">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="container app-flashes">
            {% for category, message in messages %}
              {% set bs_category = 'info' if category in ['message', 'info'] else ('danger' if category in ['error', 'danger'] else category) %}
              <div class="alert alert-{{ bs_category }}" role="alert">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </main>

    {% block scripts %}
      <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
      <script src="{{ url_for('static', filename='editor_nav.js') }}"></script>
    {% endblock %}
  </body>
</html>
